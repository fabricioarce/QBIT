version: "3.9"

services:
  bot:
    build:
      context: .
      dockerfile: dockerfile
    container_name: discord-bot
    restart: unless-stopped

    environment:
      # Discord Configuration
      - DISCORD_TOKEN=${DISCORD_TOKEN}

      # Database Configuration
      # Format: postgresql://username:password@hostname:5432/database
      - DATABASE_URL=${DATABASE_URL}

      # Logging
      - RUST_LOG=${RUST_LOG:-info}
      - RUST_BACKTRACE=${RUST_BACKTRACE:-0}

    # If your PostgreSQL is in another Docker container on the same host,
    # you can reference it by service name or container name
    # Uncomment and adjust the network configuration below if needed

    # networks:
    #   - coolify  # or whatever network name your PostgreSQL container uses

    # Health check (optional but recommended)
    healthcheck:
      test: ["CMD-SHELL", "ps aux | grep bot || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
# Uncomment this if you need to connect to an external PostgreSQL container
# and specify the network name that your PostgreSQL container is using
# networks:
#   coolify:
#     external: true
